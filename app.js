!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=2)}([function(e,t){e.exports=require("discord.js")},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const o=n(5);class a{constructor(){this._output_errors=!process.env.ERRORS||"1"==process.env.ERRORS}get connection(){return this._con||(this._con=o.createConnection({host:process.env.DB_HOST||"localhost",user:process.env.DB_USER||"root",password:process.env.DB_PSSWD||"",database:process.env.DB_NAME||"wn8master",charset:"utf8mb4_unicode_ci"})),this._con}query(e,t=[]){return r(this,void 0,void 0,(function*(){return new Promise((n,r)=>{this.connection.query(e,t,(e,t)=>{e&&(this._output_errors?r(e):r("Database error")),n(t)})})}))}beginTransaction(){return r(this,void 0,void 0,(function*(){return new Promise((e,t)=>{this.connection.beginTransaction(n=>{n&&(this._output_errors?t(n):t("Database error")),e()})})}))}commit(){return r(this,void 0,void 0,(function*(){return new Promise((e,t)=>{this.connection.commit(n=>{n&&(this._output_errors?t(n):t("Database error")),e()})})}))}rollback(){return r(this,void 0,void 0,(function*(){return new Promise((e,t)=>{this.connection.rollback(n=>{n&&(this._output_errors?t(n):t("Database error")),e()})})}))}end(){return new Promise((e,t)=>{this.connection.end(n=>{n&&(this._output_errors?t(n):t("Database error")),e()})})}}t.db=a,t.database=new a},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const o=n(0),a=n(3),i=n(4),s=n(1);if(a.config(),process.env.DISCORD_TOKEN){const e=new o.Client;e.login(process.env.DISCORD_TOKEN),e.login(process.env.DISCORD_TOKEN),e.on("message",e=>r(void 0,void 0,void 0,(function*(){let t=e.content;if(0!=t.indexOf("!wn "))return;t=t.replace("!wn ","");let n=e.content.match(/(\s*)result(\s+)(\d+)(\s+)([0-1])/i);if(0==t.indexOf("search "))i.search(t,e);else if(n){const t=n[3],r=n[5];let o=new s.db;const a=parseInt(t);if(a>10||a<0)return e.channel.send("Invalid tier");yield o.query("INSERT INTO battles VALUES (NULL, ?, ?, ?, ?)",[((new Date).getTime()/1e3).toFixed(0),r,e.channel.id,t]);const i=new Date((new Date).toISOString().split("T")[0]).getTime()/1e3,c=yield o.query("SELECT * FROM battles WHERE ch_id = ? AND time >= ? AND tier = ?",[e.channel.id,i.toFixed(0),t]);let u=0;c.forEach(e=>{1==e.result&&(u+=1)});const d=0==c.length?0:u/c.length;e.channel.send(`${"1"==r?"Won":"Lost"} a tier ${t}\n\nWin ratio for tier ${t} today : ${Math.floor(100*d)}%\nBattles played : ${c.length} - ${u} win`),yield o.end()}else e.channel.send("Could not understand the command.")})))}},function(e,t){e.exports=require("dotenv")},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{c(r.next(e))}catch(e){a(e)}}function s(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}c((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const o=n(1),a=n(6),i=n(0),s=n(7);t.search=function(e,t){return r(this,void 0,void 0,(function*(){let n=new o.db;const r=e.replace("search ","").trim(),c=yield n.query("SELECT * FROM users WHERE user_name = ?",[r]);if(1!=c.length)return t.channel.send("Could not find the user, it may not be indexed in our database yet.");const{user_id:u,user_name:d}=c[0],l=yield n.query("SELECT * FROM snapshots WHERE pid = ? ORDER BY id DESC LIMIT 1",[u]),p="https://wn8master.games/"+u;if(1!=l.length)return t.channel.send(`No snapshot found ! \nVisit ${p} to create one :-)`);const f=JSON.parse(a.readFileSync(process.env.FILES+"exp.json","utf8")),h=(yield n.query("SELECT * FROM snapshots_data WHERE id = ?",[l[0].id])).map(e=>JSON.parse(e.data)),_={IDNum:0,expDef:0,expFrag:0,expSpot:0,expDamage:0,expWinRate:0},m={damage_dealt:0,spotted:0,frags:0,dropped_capture_points:0,wins:0,battles:0};console.time("Compute duration"),h.forEach(e=>{m.damage_dealt+=e.damage_dealt,m.spotted+=e.spotted,m.frags+=e.frags,m.dropped_capture_points+=e.dropped_capture_points,m.wins+=e.wins,m.battles+=e.battles;e.damage_dealt,e.battles,e.xp,e.battles,e.spotted,e.battles,e.frags,e.battles,e.dropped_capture_points,e.battles,e.wins,e.battles;let t;try{const t=f[e.tank_id];_.expDamage+=e.battles*t.expDamage,_.expDef+=e.battles*t.expDef,_.expFrag+=e.battles*t.expFrag,_.expSpot+=e.battles*t.expSpot,_.expWinRate+=.01*e.battles*t.expWinRate}catch(e){t=-1}});const b=m.damage_dealt/_.expDamage,x=m.spotted/_.expSpot,v=m.frags/_.expFrag,g=m.dropped_capture_points/_.expDef,y=m.wins/_.expWinRate,w=s.wn8(b,x,v,g,y);console.timeEnd("Compute duration");const D=new i.RichEmbed;D.setTitle(d),D.setDescription(`Username : ${d} #${u}\nLast update : ${l[0].date}\nWN8 : ${w.toFixed(2)}\nBattles : ${m.battles}\nWin ratio : ${(100*m.wins/m.battles).toFixed(2)} %\nFrags : ${(m.frags/m.battles).toFixed(2)} / battle\n\n\nLink to update : ${p}\n            `),D.setColor(s.getColor(w,!1)),t.channel.send(D)}))}},function(e,t){e.exports=require("mysql")},function(e,t){e.exports=require("fs")},function(e,t,n){"use strict";function r(e,t,n,r,o){const a=Math.max(0,(o-.71)/(1-.71)),i=Math.max(0,(e-.22)/.78),s=Math.max(0,Math.min(i+.2,(n-.12)/.88));return 980*i+210*i*s+155*s*Math.max(0,Math.min(i+.1,(t-.38)/.62))+75*Math.max(0,Math.min(i+.1,(r-.1)/.9))*s+145*Math.min(1.8,a)}Object.defineProperty(t,"__esModule",{value:!0}),t.computeWN8=function(e,t,n,o,a,i){return r(e/i.expDamage,t/i.expSpot,n/i.expFrag,o/i.expDef,a/i.expWinRate)},t.wn8=r,t.getColor=function(e,t=!0){let n=[90,49,117];return e<300?n=[0,0,0]:e<599?n=[205,51,51]:e<899?n=[215,121,0]:e<1249?n=[215,182,0]:e<1599?n=[109,149,33]:e<1899?n=[76,118,46]:e<2349?n=[74,146,183]:e<2899&&(n=[131,87,157]),t?`rgb(${n[0]}, ${n[1]}, ${n[2]})`:n}}]);