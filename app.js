!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function s(e){try{u(r.next(e))}catch(e){a(e)}}function i(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,i)}u((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const o=n(1),a=n(3),s=n(4),i=n(5),u=n(6);if(s.config(),process.env.DISCORD_TOKEN){const e=new a.Client;e.login(process.env.DISCORD_TOKEN),e.on("message",e=>r(void 0,void 0,void 0,(function*(){let t=e.content;if(0==t.indexOf("!wn ")&&(t=t.replace("!wn ",""),0==t.indexOf("search "))){const n=t.replace("search ","").trim(),r=yield o.database.query("SELECT * FROM users WHERE user_name = ?",[n]);if(1!=r.length)return e.channel.send("Could not find the user, it may not be indexed in our database yet.");const{user_id:s,user_name:c}=r[0],p=yield o.database.query("SELECT * FROM snapshots WHERE pid = ? ORDER BY id DESC LIMIT 1",[s]),d="https://wn8master.games/"+s;if(1!=p.length)return e.channel.send(`No snapshot found ! \nVisit ${d} to create one :-)`);const l=JSON.parse(i.readFileSync(process.env.FILES+"exp.json","utf8")),f=(yield o.database.query("SELECT * FROM snapshots_data WHERE id = ?",[p[0].id])).map(e=>JSON.parse(e.data)),_={IDNum:0,expDef:0,expFrag:0,expSpot:0,expDamage:0,expWinRate:0},h={damage_dealt:0,spotted:0,frags:0,dropped_capture_points:0,wins:0,battles:0};console.time("Compute duration"),f.forEach(e=>{h.damage_dealt+=e.damage_dealt,h.spotted+=e.spotted,h.frags+=e.frags,h.dropped_capture_points+=e.dropped_capture_points,h.wins+=e.wins,h.battles+=e.battles;e.damage_dealt,e.battles,e.xp,e.battles,e.spotted,e.battles,e.frags,e.battles,e.dropped_capture_points,e.battles,e.wins,e.battles;let t;try{const t=l[e.tank_id];_.expDamage+=e.battles*t.expDamage,_.expDef+=e.battles*t.expDef,_.expFrag+=e.battles*t.expFrag,_.expSpot+=e.battles*t.expSpot,_.expWinRate+=.01*e.battles*t.expWinRate}catch(e){t=-1}});const m=h.damage_dealt/_.expDamage,b=h.spotted/_.expSpot,x=h.frags/_.expFrag,g=h.dropped_capture_points/_.expDef,v=h.wins/_.expWinRate,y=u.wn8(m,b,x,g,v);console.timeEnd("Compute duration");const w=new a.MessageEmbed;w.setTitle(c),w.setDescription(`Username : ${c} #${s}\nLast update : ${p[0].date}\nWN8 : ${y.toFixed(2)}\nBattles : ${h.battles}\nWin ratio : ${(100*h.wins/h.battles).toFixed(2)} %\nFrags : ${(h.frags/h.battles).toFixed(2)} / battle\n\n\nLink to update : ${d}\n            `),w.setColor(u.getColor(y,!1)),e.channel.send(w)}})))}},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function s(e){try{u(r.next(e))}catch(e){a(e)}}function i(e){try{u(r.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,i)}u((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const o=n(2);class a{constructor(){this._output_errors=!process.env.ERRORS||"1"==process.env.ERRORS}get connection(){return this._con||(this._con=o.createConnection({host:process.env.DB_HOST||"localhost",user:process.env.DB_USER||"root",password:process.env.DB_PSSWD||"",database:process.env.DB_NAME||"wn8master",charset:"utf8mb4_unicode_ci"})),this._con}query(e,t=[]){return r(this,void 0,void 0,(function*(){return new Promise((n,r)=>{this.connection.query(e,t,(e,t)=>{e&&(this._output_errors?r(e):r("Database error")),n(t)})})}))}beginTransaction(){return r(this,void 0,void 0,(function*(){return new Promise((e,t)=>{this.connection.beginTransaction(n=>{n&&(this._output_errors?t(n):t("Database error")),e()})})}))}commit(){return r(this,void 0,void 0,(function*(){return new Promise((e,t)=>{this.connection.commit(n=>{n&&(this._output_errors?t(n):t("Database error")),e()})})}))}rollback(){return r(this,void 0,void 0,(function*(){return new Promise((e,t)=>{this.connection.rollback(n=>{n&&(this._output_errors?t(n):t("Database error")),e()})})}))}end(){return new Promise((e,t)=>{this.connection.end(n=>{n&&(this._output_errors?t(n):t("Database error")),e()})})}}t.db=a,t.database=new a},function(e,t){e.exports=require("mysql")},function(e,t){e.exports=require("discord.js")},function(e,t){e.exports=require("dotenv")},function(e,t){e.exports=require("fs")},function(e,t,n){"use strict";function r(e,t,n,r,o){const a=Math.max(0,(o-.71)/(1-.71)),s=Math.max(0,(e-.22)/.78),i=Math.max(0,Math.min(s+.2,(n-.12)/.88));return 980*s+210*s*i+155*i*Math.max(0,Math.min(s+.1,(t-.38)/.62))+75*Math.max(0,Math.min(s+.1,(r-.1)/.9))*i+145*Math.min(1.8,a)}Object.defineProperty(t,"__esModule",{value:!0}),t.computeWN8=function(e,t,n,o,a,s){return r(e/s.expDamage,t/s.expSpot,n/s.expFrag,o/s.expDef,a/s.expWinRate)},t.wn8=r,t.getColor=function(e,t=!0){let n=[90,49,117];return e<300?n=[0,0,0]:e<599?n=[205,51,51]:e<899?n=[215,121,0]:e<1249?n=[215,182,0]:e<1599?n=[109,149,33]:e<1899?n=[76,118,46]:e<2349?n=[74,146,183]:e<2899&&(n=[131,87,157]),t?`rgb(${n[0]}, ${n[1]}, ${n[2]})`:n}}]);